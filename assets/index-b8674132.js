import{i as Q}from"./index-18acf776.js";import{d as _e,r as M,q as U,l as he,p as ge,c as P,a as o,g as E,w as s,v as R,e as l,x as W,f as d,o as x,F as X,b as Y,t as i,i as n,n as Z,h as ye,E as ee,y as we,_ as Ae}from"./index-41145b5f.js";const be={class:"monitoring-container"},xe={class:"device-selector"},Ce={class:"device-option"},Me={class:"monitor-card"},De={class:"card-info"},Be={class:"card-title"},Ve={class:"card-header"},Ee={class:"card-header"},Se={class:"card-header"},ze={class:"header-left"},ke={class:"header-right"},$e=_e({__name:"index",setup(Ie){const O={"A-101":{name:"双色注塑机-1号",temperature:185,pressure:12.5,tempAmplitude:2,pressureAmplitude:.3,frequency:.2},"A-102":{name:"立式注塑机-2号",temperature:180,pressure:12.8,tempAmplitude:1.8,pressureAmplitude:.25,frequency:.15},"A-103":{name:"卧式注塑机-3号",temperature:178,pressure:12.3,tempAmplitude:1.9,pressureAmplitude:.28,frequency:.18},"B-201":{name:"双螺杆挤出机-1号",temperature:165,pressure:15.2,tempAmplitude:1.5,pressureAmplitude:.35,frequency:.25},"B-202":{name:"单螺杆挤出机-2号",temperature:168,pressure:15.5,tempAmplitude:1.6,pressureAmplitude:.32,frequency:.22},"B-203":{name:"造粒挤出机-3号",temperature:170,pressure:15,tempAmplitude:1.7,pressureAmplitude:.3,frequency:.2},"C-301":{name:"中空吹塑机-1号",temperature:195,pressure:10.5,tempAmplitude:2.2,pressureAmplitude:.22,frequency:.3},"C-302":{name:"片材吹塑机-2号",temperature:192,pressure:10.8,tempAmplitude:2.1,pressureAmplitude:.25,frequency:.28}},_={temperature_high:{name:"温度过高",level:"error",threshold:{A:195,B:180,C:205}},temperature_low:{name:"温度过低",level:"warning",threshold:{A:170,B:155,C:180}},pressure_high:{name:"压力过高",level:"error",threshold:{A:14,B:17,C:12}},pressure_low:{name:"压力过低",level:"warning",threshold:{A:11,B:13.5,C:9}},system_error:{name:"系统异常",level:"error"}},h=M(Object.entries(O).map(([t,e])=>({id:t,name:e.name,status:"running",data:{temperature:e.temperature,pressure:e.pressure,humidity:45,lastUpdate:new Date().toISOString()}}))),D=M(h.value[0].id),C=M("single"),g=M([]),k=M("all"),F=M(!1),v=M(null);let p=null,m=null,L=null,N=null;const te=U(()=>k.value==="all"?g.value:g.value.filter(t=>k.value==="active"?t.status==="active":t.status==="resolved")),ae=U(()=>g.value.filter(t=>t.status==="active")),se=U(()=>{const t=h.value.find(e=>e.id===D.value);return t?[{title:"当前温度",value:`${t.data.temperature.toFixed(1)}℃`,status:H("temperature",t.data.temperature,t.id.charAt(0))},{title:"当前压力",value:`${t.data.pressure.toFixed(2)}MPa`,status:H("pressure",t.data.pressure,t.id.charAt(0))},{title:"湿度",value:`${t.data.humidity}%`,status:t.data.humidity>60?"warning":"normal"},{title:"设备状态",value:t.status==="running"?"运行中":"已停止",status:t.status==="running"?"normal":"warning"}]:[]}),H=(t,e,a)=>{if(t==="temperature"){if(e>=_.temperature_high.threshold[a])return"error";if(e<=_.temperature_low.threshold[a])return"warning"}else if(t==="pressure"){if(e>=_.pressure_high.threshold[a])return"error";if(e<=_.pressure_low.threshold[a])return"warning"}return"normal"},G=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),le=t=>({当前温度:"Thermometer",当前压力:"Odometer",湿度:"Sunny",设备状态:"Monitor"})[t]||"More",T=(t,e)=>+(t+(Math.random()-.5)*e).toFixed(1),re=t=>t.status==="active"?"warning-row":"",j=t=>({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},grid:{top:60,left:50,right:20,bottom:30,containLabel:!0},xAxis:{type:"time",boundaryGap:!1,splitLine:{show:!1},axisLabel:{formatter:e=>{const a=new Date(e);return`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`}}},yAxis:{type:"value",name:t,nameLocation:"end",nameGap:15,nameRotate:0,nameTextStyle:{align:"right",padding:[0,0,0,5]},splitLine:{show:!0,lineStyle:{type:"dashed"}}}}),$=(t,e,a,c)=>{const y=new Date().getTime(),f=[],u=O[a];if(!u)return f;const B={base:c==="temperature"?u.temperature:u.pressure,amplitude:c==="temperature"?u.tempAmplitude:u.pressureAmplitude,frequency:u.frequency*(c==="temperature"?1:1.5)},w=a.charAt(0),z=c==="temperature"?w==="A"?.4:w==="B"?.3:.2:w==="A"?.2:w==="B"?.25:.15;for(let A=-60;A<=0;A++){const b=y+A*1e3,q=B.base+B.amplitude*Math.sin(A*B.frequency)+(Math.random()-.5)*e*z+(c==="temperature"?Math.sin(A/120):Math.cos(A/180))*B.amplitude*.5;f.push([b,+q.toFixed(2)])}return f},J=()=>{const t=document.getElementById("temperatureChart"),e=document.getElementById("pressureChart");t&&(p=Q(t),p.setOption({...j("温度(℃)"),legend:{show:C.value==="multiple",top:10,type:"scroll"},series:[{name:"温度",type:"line",smooth:!0,data:[]}]})),e&&(m=Q(e),m.setOption({...j("压力(MPa)"),legend:{show:C.value==="multiple",top:10,type:"scroll"},series:[{name:"压力",type:"line",smooth:!0,data:[]}]}))},I=t=>{if(!p||!m)return;const e=$(t.data.temperature,2,t.id,"temperature"),a=$(t.data.pressure,.2,t.id,"pressure");p.setOption({series:[{data:e}]}),m.setOption({series:[{data:a}]})},K=()=>{if(!p||!m)return;const t=h.value.map(a=>({name:a.name,type:"line",smooth:!0,showSymbol:!1,data:$(a.data.temperature,2,a.id,"temperature")})),e=h.value.map(a=>({name:a.name,type:"line",smooth:!0,showSymbol:!1,data:$(a.data.pressure,.2,a.id,"pressure")}));p.setOption({legend:{show:!0,top:10,type:"scroll"},series:t}),m.setOption({legend:{show:!0,top:10,type:"scroll"},series:e})},ne=t=>{const e=t.id.charAt(0),{temperature:a,pressure:c}=t.data;if(a>=_.temperature_high.threshold[e]&&Math.random()<.1?S(t,"temperature_high",a.toFixed(1),"℃","error"):a<=_.temperature_low.threshold[e]&&Math.random()<.1&&S(t,"temperature_low",a.toFixed(1),"℃","warning"),c>=_.pressure_high.threshold[e]&&Math.random()<.1?S(t,"pressure_high",c.toFixed(2),"MPa","error"):c<=_.pressure_low.threshold[e]&&Math.random()<.1&&S(t,"pressure_low",c.toFixed(2),"MPa","warning"),Math.random()<.001){const y=[{value:"E001",desc:"通信总线异常"},{value:"E002",desc:"温度传感器故障"},{value:"E003",desc:"压力传感器故障"},{value:"E004",desc:"伺服电机异常"},{value:"E005",desc:"液压系统故障"},{value:"E006",desc:"加热器故障"},{value:"E007",desc:"冷却系统异常"},{value:"E008",desc:"安全门未关闭"}],f=y[Math.floor(Math.random()*y.length)];S(t,"system_error",`${f.value}: ${f.desc}`,"","error")}},S=(t,e,a,c,y)=>{if(!g.value.find(u=>u.deviceId===t.id&&u.type===e&&u.status==="active")){const u={id:`${e}-${t.id}-${Date.now()}`,time:new Date().toISOString(),deviceId:t.id,deviceName:t.name,type:e,typeName:_[e].name,value:a,unit:c,level:y,status:"active"};g.value.unshift(u),g.value.length>100&&(g.value=g.value.slice(0,100)),ee({type:y==="error"?"error":"warning",message:`${t.name} - ${_[e].name}`,duration:3e3})}},oe=t=>{const e=h.value.find(a=>a.id===t);e&&I(e)},ie=async t=>{if(C.value=t,await W(),p&&p.dispose(),m&&m.dispose(),J(),await W(),t==="single"){const e=h.value.find(a=>a.id===D.value);e&&I(e)}else K()},ue=async t=>{try{await we.confirm("确认处理此报警吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),t.status="resolved",ee.success("报警已处理")}catch{}},de=t=>{v.value=t,F.value=!0},pe=()=>{if(h.value.forEach(t=>{if(t.status==="running"){const e=O[t.id];if(!e)return;t.data={temperature:T(e.temperature,e.tempAmplitude),pressure:T(e.pressure,e.pressureAmplitude),humidity:T(45,10),lastUpdate:new Date().toISOString()},ne(t)}}),C.value==="single"){const t=h.value.find(e=>e.id===D.value);t&&I(t)}else K()};return he(()=>{J();const t=h.value.find(a=>a.id===D.value);t&&I(t),L=window.setInterval(()=>{pe()},1e3),N=window.setInterval(()=>{g.value.forEach(a=>{a.status==="active"&&Math.random()<.05&&(a.status="resolved")})},1e4);const e=()=>{p==null||p.resize(),m==null||m.resize()};window.addEventListener("resize",e),resizeHandler=e}),ge(()=>{L&&window.clearInterval(L),N&&window.clearInterval(N),resizeHandler&&window.removeEventListener("resize",resizeHandler),p==null||p.dispose(),m==null||m.dispose()}),(t,e)=>{const a=d("el-tag"),c=d("el-option"),y=d("el-select"),f=d("el-radio-button"),u=d("el-radio-group"),B=d("el-icon"),w=d("el-card"),z=d("el-col"),A=d("el-row"),b=d("el-table-column"),q=d("el-button"),me=d("el-table"),V=d("el-descriptions-item"),ce=d("el-descriptions"),fe=d("el-dialog");return x(),P("div",be,[o("div",xe,[C.value==="single"?(x(),E(y,{key:0,modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=r=>D.value=r),placeholder:"请选择监控设备",class:"device-select",onChange:oe},{default:s(()=>[(x(!0),P(X,null,Y(h.value,r=>(x(),E(c,{key:r.id,label:r.name,value:r.id},{default:s(()=>[o("div",Ce,[o("span",null,i(r.name),1),l(a,{size:"small",type:r.status==="running"?"success":"danger"},{default:s(()=>[n(i(r.status==="running"?"运行中":"已停止"),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):R("",!0),l(u,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=r=>C.value=r),class:"display-mode",onChange:ie},{default:s(()=>[l(f,{label:"single"},{default:s(()=>e[4]||(e[4]=[n("单设备视图")])),_:1}),l(f,{label:"multiple"},{default:s(()=>e[5]||(e[5]=[n("多设备对比")])),_:1})]),_:1},8,["modelValue"])]),l(A,{gutter:24,class:"monitor-cards"},{default:s(()=>[(x(!0),P(X,null,Y(se.value,r=>(x(),E(z,{span:6,key:r.title},{default:s(()=>[l(w,{shadow:"hover","body-style":{padding:"20px"}},{default:s(()=>[o("div",Me,[o("div",{class:Z(["card-icon",r.status])},[l(B,{size:24},{default:s(()=>[(x(),E(ye(le(r.title))))]),_:2},1024)],2),o("div",De,[o("div",Be,i(r.title),1),o("div",{class:Z(["card-value",r.status])},i(r.value),3)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(A,{gutter:24,class:"chart-section"},{default:s(()=>[l(z,{span:12},{default:s(()=>[l(w,{class:"chart-card"},{header:s(()=>[o("div",Ve,[e[7]||(e[7]=o("span",{class:"title"},"温度实时监控",-1)),l(a,{effect:"plain",type:"success"},{default:s(()=>e[6]||(e[6]=[n("实时更新")])),_:1})])]),default:s(()=>[e[8]||(e[8]=o("div",{id:"temperatureChart",style:{height:"380px"}},null,-1))]),_:1})]),_:1}),l(z,{span:12},{default:s(()=>[l(w,{class:"chart-card"},{header:s(()=>[o("div",Ee,[e[10]||(e[10]=o("span",{class:"title"},"压力实时监控",-1)),l(a,{effect:"plain",type:"success"},{default:s(()=>e[9]||(e[9]=[n("实时更新")])),_:1})])]),default:s(()=>[e[11]||(e[11]=o("div",{id:"pressureChart",style:{height:"380px"}},null,-1))]),_:1})]),_:1})]),_:1}),l(w,{class:"alert-card"},{header:s(()=>[o("div",Se,[o("div",ze,[e[12]||(e[12]=o("span",{class:"title"},"报警记录",-1)),l(a,{effect:"plain",type:"danger",class:"alert-count"},{default:s(()=>[n(i(ae.value.length)+" 条未处理 ",1)]),_:1})]),o("div",ke,[l(u,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=r=>k.value=r),size:"small"},{default:s(()=>[l(f,{label:"all"},{default:s(()=>e[13]||(e[13]=[n("全部")])),_:1}),l(f,{label:"active"},{default:s(()=>e[14]||(e[14]=[n("未处理")])),_:1}),l(f,{label:"resolved"},{default:s(()=>e[15]||(e[15]=[n("已处理")])),_:1})]),_:1},8,["modelValue"])])])]),default:s(()=>[l(me,{data:te.value,style:{width:"100%"},"max-height":400,"row-class-name":re},{default:s(()=>[l(b,{prop:"time",label:"时间",width:"160"},{default:s(({row:r})=>[n(i(G(r.time)),1)]),_:1}),l(b,{prop:"deviceName",label:"设备名称",width:"160"}),l(b,{prop:"typeName",label:"报警类型",width:"120"}),l(b,{label:"报警值",width:"120",align:"center"},{default:s(({row:r})=>[n(i(r.value)+i(r.unit),1)]),_:1}),l(b,{label:"报警等级",width:"100"},{default:s(({row:r})=>[l(a,{type:r.level==="error"?"danger":"warning",effect:r.status==="active"?"light":"plain",size:"small"},{default:s(()=>[n(i(r.level==="error"?"严重":"警告"),1)]),_:2},1032,["type","effect"])]),_:1}),l(b,{label:"状态",width:"100"},{default:s(({row:r})=>[l(a,{type:r.status==="active"?"danger":"success",effect:r.status==="active"?"light":"plain",size:"small"},{default:s(()=>[n(i(r.status==="active"?"未处理":"已处理"),1)]),_:2},1032,["type","effect"])]),_:1}),l(b,{label:"操作",width:"180",fixed:"right"},{default:s(({row:r})=>[r.status==="active"?(x(),E(q,{key:0,type:"primary",link:"",size:"small",onClick:ve=>ue(r)},{default:s(()=>e[16]||(e[16]=[n(" 处理 ")])),_:2},1032,["onClick"])):R("",!0),l(q,{type:"primary",link:"",size:"small",onClick:ve=>de(r)},{default:s(()=>e[17]||(e[17]=[n(" 详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(fe,{modelValue:F.value,"onUpdate:modelValue":e[3]||(e[3]=r=>F.value=r),title:"报警详情",width:"600px"},{default:s(()=>[v.value?(x(),E(ce,{key:0,column:2,border:""},{default:s(()=>[l(V,{label:"报警时间"},{default:s(()=>[n(i(G(v.value.time)),1)]),_:1}),l(V,{label:"设备名称"},{default:s(()=>[n(i(v.value.deviceName),1)]),_:1}),l(V,{label:"报警类型"},{default:s(()=>[n(i(v.value.typeName),1)]),_:1}),l(V,{label:"报警值"},{default:s(()=>[n(i(v.value.value)+i(v.value.unit),1)]),_:1}),l(V,{label:"报警等级"},{default:s(()=>[l(a,{type:v.value.level==="error"?"danger":"warning"},{default:s(()=>[n(i(v.value.level==="error"?"严重":"警告"),1)]),_:1},8,["type"])]),_:1}),l(V,{label:"状态"},{default:s(()=>[l(a,{type:v.value.status==="active"?"danger":"success"},{default:s(()=>[n(i(v.value.status==="active"?"未处理":"已处理"),1)]),_:1},8,["type"])]),_:1})]),_:1})):R("",!0)]),_:1},8,["modelValue"])])}}});const Fe=Ae($e,[["__scopeId","data-v-03898873"]]);export{Fe as default};
