import{i as W}from"./index-18acf776.js";import{d as ge,r as M,q as U,l as ye,p as we,c as R,a as i,g as I,w as s,v as G,e as l,x as X,f as d,o as x,F as Y,b as Z,t as o,i as n,n as ee,h as Ae,E as te,y as be,_ as xe}from"./index-6ff9ca82.js";const Ce={class:"monitoring-container"},Me={class:"device-selector"},Ne={class:"device-option"},Be={class:"monitor-card"},De={class:"card-info"},Ie={class:"card-title"},Ee={class:"card-header"},Ve={class:"card-header"},Te={class:"card-header"},Se={class:"header-left"},ke={class:"header-right"},ze=ge({__name:"index",setup($e){const $={"A-101":{name:"双色注塑机-1号",temperature:185,pressure:12.5,tempAmplitude:2,pressureAmplitude:.3,frequency:.2},"A-102":{name:"立式注塑机-2号",temperature:180,pressure:12.8,tempAmplitude:1.8,pressureAmplitude:.25,frequency:.15},"A-103":{name:"卧式注塑机-3号",temperature:178,pressure:12.3,tempAmplitude:1.9,pressureAmplitude:.28,frequency:.18},"B-201":{name:"双螺杆挤出机-1号",temperature:165,pressure:15.2,tempAmplitude:1.5,pressureAmplitude:.35,frequency:.25},"B-202":{name:"单螺杆挤出机-2号",temperature:168,pressure:15.5,tempAmplitude:1.6,pressureAmplitude:.32,frequency:.22},"B-203":{name:"造粒挤出机-3号",temperature:170,pressure:15,tempAmplitude:1.7,pressureAmplitude:.3,frequency:.2},"C-301":{name:"中空吹塑机-1号",temperature:195,pressure:10.5,tempAmplitude:2.2,pressureAmplitude:.22,frequency:.3},"C-302":{name:"片材吹塑机-2号",temperature:192,pressure:10.8,tempAmplitude:2.1,pressureAmplitude:.25,frequency:.28}},h={temperature_high:{name:"温度过高",level:"error",threshold:{A:195,B:180,C:205}},temperature_low:{name:"温度过低",level:"warning",threshold:{A:170,B:155,C:180}},pressure_high:{name:"压力过高",level:"error",threshold:{A:14,B:17,C:12}},pressure_low:{name:"压力过低",level:"warning",threshold:{A:11,B:13.5,C:9}},system_error:{name:"系统异常",level:"error"}},_=M(Object.entries($).map(([t,e])=>({id:t,name:e.name,status:"running",data:{temperature:e.temperature,pressure:e.pressure,humidity:45,lastUpdate:new Date().toISOString()}}))),N=M(_.value[0].id),C=M("single"),g=M([]),T=M("all"),q=M(!1),f=M(null);let O=null,p=null,m=null,F=null,L=null;const ae=[{id:"temp-high-A101-1",time:"2025-01-12T08:15:23",deviceId:"A-101",deviceName:"双色注塑机-1号",type:"temperature_high",typeName:"温度过高",value:"198.5",unit:"℃",level:"error",status:"active"},{id:"press-low-B201-1",time:"2025-01-12T08:10:15",deviceId:"B-201",deviceName:"双螺杆挤出机-1号",type:"pressure_low",typeName:"压力过低",value:"13.2",unit:"MPa",level:"warning",status:"active"},{id:"sys-err-C301-1",time:"2025-01-11T08:05:30",deviceId:"C-301",deviceName:"中空吹塑机-1号",type:"system_error",typeName:"系统异常",value:"E002: 温度传感器故障",unit:"",level:"error",status:"active"},{id:"temp-low-A102-1",time:"2025-01-11T07:55:12",deviceId:"A-102",deviceName:"立式注塑机-2号",type:"temperature_low",typeName:"温度过低",value:"168.5",unit:"℃",level:"warning",status:"resolved"},{id:"press-high-B202-1",time:"2025-01-11T07:45:33",deviceId:"B-202",deviceName:"单螺杆挤出机-2号",type:"pressure_high",typeName:"压力过高",value:"17.8",unit:"MPa",level:"error",status:"resolved"},{id:"sys-err-A103-1",time:"2025-01-10T07:30:45",deviceId:"A-103",deviceName:"卧式注塑机-3号",type:"system_error",typeName:"系统异常",value:"E004: 伺服电机异常",unit:"",level:"error",status:"resolved"},{id:"temp-high-C302-1",time:"2025-01-09T07:25:18",deviceId:"C-302",deviceName:"片材吹塑机-2号",type:"temperature_high",typeName:"温度过高",value:"208.3",unit:"℃",level:"error",status:"resolved"},{id:"press-low-B203-1",time:"2025-01-09T07:15:55",deviceId:"B-203",deviceName:"造粒挤出机-3号",type:"pressure_low",typeName:"压力过低",value:"13.1",unit:"MPa",level:"warning",status:"resolved"}];g.value=ae;const se=U(()=>T.value==="all"?g.value:g.value.filter(t=>T.value==="active"?t.status==="active":t.status==="resolved")),le=U(()=>g.value.filter(t=>t.status==="active")),re=U(()=>{const t=_.value.find(e=>e.id===N.value);return t?[{title:"当前温度",value:`${t.data.temperature.toFixed(1)}℃`,status:H("temperature",t.data.temperature,t.id.charAt(0))},{title:"当前压力",value:`${t.data.pressure.toFixed(2)}MPa`,status:H("pressure",t.data.pressure,t.id.charAt(0))},{title:"湿度",value:`${t.data.humidity}%`,status:t.data.humidity>60?"warning":"normal"},{title:"设备状态",value:t.status==="running"?"运行中":"已停止",status:t.status==="running"?"normal":"warning"}]:[]}),H=(t,e,a)=>{if(t==="temperature"){if(e>=h.temperature_high.threshold[a])return"error";if(e<=h.temperature_low.threshold[a])return"warning"}else if(t==="pressure"){if(e>=h.pressure_high.threshold[a])return"error";if(e<=h.pressure_low.threshold[a])return"warning"}return"normal"},j=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),ne=t=>({当前温度:"Thermometer",当前压力:"Odometer",湿度:"Sunny",设备状态:"Monitor"})[t]||"More",P=(t,e)=>+(t+(Math.random()-.5)*e).toFixed(1),ie=t=>t.status==="active"?"warning-row":"",J=t=>({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},grid:{top:60,left:50,right:20,bottom:30,containLabel:!0},xAxis:{type:"time",boundaryGap:!1,splitLine:{show:!1},axisLabel:{formatter:e=>{const a=new Date(e);return`${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}`}}},yAxis:{type:"value",name:t,nameLocation:"end",nameGap:15,nameRotate:0,nameTextStyle:{align:"right",padding:[0,0,0,5]},splitLine:{show:!0,lineStyle:{type:"dashed"}}}}),S=(t,e,a,c)=>{const y=new Date().getTime(),v=[],u=$[a];if(!u)return v;const B={base:c==="temperature"?u.temperature:u.pressure,amplitude:c==="temperature"?u.tempAmplitude:u.pressureAmplitude,frequency:u.frequency*(c==="temperature"?1:1.5)},w=a.charAt(0),V=c==="temperature"?w==="A"?.4:w==="B"?.3:.2:w==="A"?.2:w==="B"?.25:.15;for(let A=-60;A<=0;A++){const b=y+A*1e3,z=B.base+B.amplitude*Math.sin(A*B.frequency)+(Math.random()-.5)*e*V+(c==="temperature"?Math.sin(A/120):Math.cos(A/180))*B.amplitude*.5;v.push([b,+z.toFixed(2)])}return v},K=()=>{const t=document.getElementById("temperatureChart"),e=document.getElementById("pressureChart");t&&(p=W(t),p.setOption({...J("温度(℃)"),legend:{show:C.value==="multiple",top:10,type:"scroll"},series:[{name:"温度",type:"line",smooth:!0,data:[]}]})),e&&(m=W(e),m.setOption({...J("压力(MPa)"),legend:{show:C.value==="multiple",top:10,type:"scroll"},series:[{name:"压力",type:"line",smooth:!0,data:[]}]}))},k=t=>{if(!p||!m)return;const e=S(t.data.temperature,2,t.id,"temperature"),a=S(t.data.pressure,.2,t.id,"pressure");p.setOption({series:[{data:e}]}),m.setOption({series:[{data:a}]})},Q=()=>{if(!p||!m)return;const t=_.value.map(a=>({name:a.name,type:"line",smooth:!0,showSymbol:!1,data:S(a.data.temperature,2,a.id,"temperature")})),e=_.value.map(a=>({name:a.name,type:"line",smooth:!0,showSymbol:!1,data:S(a.data.pressure,.2,a.id,"pressure")}));p.setOption({legend:{show:!0,top:10,type:"scroll"},series:t}),m.setOption({legend:{show:!0,top:10,type:"scroll"},series:e})},oe=t=>{const e=t.id.charAt(0),{temperature:a,pressure:c}=t.data;if(a>=h.temperature_high.threshold[e]&&Math.random()<.1?E(t,"temperature_high",a.toFixed(1),"℃","error"):a<=h.temperature_low.threshold[e]&&Math.random()<.1&&E(t,"temperature_low",a.toFixed(1),"℃","warning"),c>=h.pressure_high.threshold[e]&&Math.random()<.1?E(t,"pressure_high",c.toFixed(2),"MPa","error"):c<=h.pressure_low.threshold[e]&&Math.random()<.1&&E(t,"pressure_low",c.toFixed(2),"MPa","warning"),Math.random()<.001){const y=[{value:"E001",desc:"通信总线异常"},{value:"E002",desc:"温度传感器故障"},{value:"E003",desc:"压力传感器故障"},{value:"E004",desc:"伺服电机异常"},{value:"E005",desc:"液压系统故障"},{value:"E006",desc:"加热器故障"},{value:"E007",desc:"冷却系统异常"},{value:"E008",desc:"安全门未关闭"}],v=y[Math.floor(Math.random()*y.length)];E(t,"system_error",`${v.value}: ${v.desc}`,"","error")}},E=(t,e,a,c,y)=>{if(!g.value.find(u=>u.deviceId===t.id&&u.type===e&&u.status==="active")){const u={id:`${e}-${t.id}-${Date.now()}`,time:new Date().toISOString(),deviceId:t.id,deviceName:t.name,type:e,typeName:h[e].name,value:a,unit:c,level:y,status:"active"};g.value.unshift(u),g.value.length>100&&(g.value=g.value.slice(0,100)),te({type:y==="error"?"error":"warning",message:`${t.name} - ${h[e].name}`,duration:3e3})}},ue=t=>{const e=_.value.find(a=>a.id===t);e&&k(e)},de=async t=>{if(C.value=t,await X(),p&&p.dispose(),m&&m.dispose(),K(),await X(),t==="single"){const e=_.value.find(a=>a.id===N.value);e&&k(e)}else Q()},pe=async t=>{try{await be.confirm("确认处理此报警吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),t.status="resolved",te.success("报警已处理")}catch{}},me=t=>{f.value=t,q.value=!0},ce=()=>{if(_.value.forEach(t=>{if(t.status==="running"){const e=$[t.id];if(!e)return;t.data={temperature:P(e.temperature,e.tempAmplitude),pressure:P(e.pressure,e.pressureAmplitude),humidity:P(45,10),lastUpdate:new Date().toISOString()},oe(t)}}),C.value==="single"){const t=_.value.find(e=>e.id===N.value);t&&k(t)}else Q()};return ye(()=>{K();const t=_.value.find(a=>a.id===N.value);t&&k(t),F=window.setInterval(()=>{ce()},1e3),L=window.setInterval(()=>{g.value.forEach(a=>{a.status==="active"&&Math.random()<.05&&(a.status="resolved")})},1e4);const e=()=>{p==null||p.resize(),m==null||m.resize()};window.addEventListener("resize",e),O=e}),we(()=>{F&&window.clearInterval(F),L&&window.clearInterval(L),O&&window.removeEventListener("resize",O),p==null||p.dispose(),m==null||m.dispose()}),(t,e)=>{const a=d("el-tag"),c=d("el-option"),y=d("el-select"),v=d("el-radio-button"),u=d("el-radio-group"),B=d("el-icon"),w=d("el-card"),V=d("el-col"),A=d("el-row"),b=d("el-table-column"),z=d("el-button"),ve=d("el-table"),D=d("el-descriptions-item"),fe=d("el-descriptions"),he=d("el-dialog");return x(),R("div",Ce,[i("div",Me,[C.value==="single"?(x(),I(y,{key:0,modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=r=>N.value=r),placeholder:"请选择监控设备",class:"device-select",onChange:ue},{default:s(()=>[(x(!0),R(Y,null,Z(_.value,r=>(x(),I(c,{key:r.id,label:r.name,value:r.id},{default:s(()=>[i("div",Ne,[i("span",null,o(r.name),1),l(a,{size:"small",type:r.status==="running"?"success":"danger"},{default:s(()=>[n(o(r.status==="running"?"运行中":"已停止"),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):G("",!0),l(u,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=r=>C.value=r),class:"display-mode",onChange:de},{default:s(()=>[l(v,{label:"single"},{default:s(()=>e[4]||(e[4]=[n("单设备视图")])),_:1}),l(v,{label:"multiple"},{default:s(()=>e[5]||(e[5]=[n("多设备对比")])),_:1})]),_:1},8,["modelValue"])]),l(A,{gutter:24,class:"monitor-cards"},{default:s(()=>[(x(!0),R(Y,null,Z(re.value,r=>(x(),I(V,{span:6,key:r.title},{default:s(()=>[l(w,{shadow:"hover","body-style":{padding:"20px"}},{default:s(()=>[i("div",Be,[i("div",{class:ee(["card-icon",r.status])},[l(B,{size:24},{default:s(()=>[(x(),I(Ae(ne(r.title))))]),_:2},1024)],2),i("div",De,[i("div",Ie,o(r.title),1),i("div",{class:ee(["card-value",r.status])},o(r.value),3)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(A,{gutter:24,class:"chart-section"},{default:s(()=>[l(V,{span:12},{default:s(()=>[l(w,{class:"chart-card"},{header:s(()=>[i("div",Ee,[e[7]||(e[7]=i("span",{class:"title"},"温度实时监控",-1)),l(a,{effect:"plain",type:"success"},{default:s(()=>e[6]||(e[6]=[n("实时更新")])),_:1})])]),default:s(()=>[e[8]||(e[8]=i("div",{id:"temperatureChart",style:{height:"380px"}},null,-1))]),_:1})]),_:1}),l(V,{span:12},{default:s(()=>[l(w,{class:"chart-card"},{header:s(()=>[i("div",Ve,[e[10]||(e[10]=i("span",{class:"title"},"压力实时监控",-1)),l(a,{effect:"plain",type:"success"},{default:s(()=>e[9]||(e[9]=[n("实时更新")])),_:1})])]),default:s(()=>[e[11]||(e[11]=i("div",{id:"pressureChart",style:{height:"380px"}},null,-1))]),_:1})]),_:1})]),_:1}),l(w,{class:"alert-card"},{header:s(()=>[i("div",Te,[i("div",Se,[e[12]||(e[12]=i("span",{class:"title"},"报警记录",-1)),l(a,{effect:"plain",type:"danger",class:"alert-count"},{default:s(()=>[n(o(le.value.length)+" 条未处理 ",1)]),_:1})]),i("div",ke,[l(u,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=r=>T.value=r),size:"small"},{default:s(()=>[l(v,{label:"all"},{default:s(()=>e[13]||(e[13]=[n("全部")])),_:1}),l(v,{label:"active"},{default:s(()=>e[14]||(e[14]=[n("未处理")])),_:1}),l(v,{label:"resolved"},{default:s(()=>e[15]||(e[15]=[n("已处理")])),_:1})]),_:1},8,["modelValue"])])])]),default:s(()=>[l(ve,{data:se.value,style:{width:"100%"},"max-height":400,"row-class-name":ie},{default:s(()=>[l(b,{prop:"time",label:"时间",width:"160"},{default:s(({row:r})=>[n(o(j(r.time)),1)]),_:1}),l(b,{prop:"deviceName",label:"设备名称",width:"160"}),l(b,{prop:"typeName",label:"报警类型",width:"120"}),l(b,{label:"报警值",width:"120",align:"center"},{default:s(({row:r})=>[n(o(r.value)+o(r.unit),1)]),_:1}),l(b,{label:"报警等级",width:"100"},{default:s(({row:r})=>[l(a,{type:r.level==="error"?"danger":"warning",effect:r.status==="active"?"light":"plain",size:"small"},{default:s(()=>[n(o(r.level==="error"?"严重":"警告"),1)]),_:2},1032,["type","effect"])]),_:1}),l(b,{label:"状态",width:"100"},{default:s(({row:r})=>[l(a,{type:r.status==="active"?"danger":"success",effect:r.status==="active"?"light":"plain",size:"small"},{default:s(()=>[n(o(r.status==="active"?"未处理":"已处理"),1)]),_:2},1032,["type","effect"])]),_:1}),l(b,{label:"操作",width:"180",fixed:"right"},{default:s(({row:r})=>[r.status==="active"?(x(),I(z,{key:0,type:"primary",link:"",size:"small",onClick:_e=>pe(r)},{default:s(()=>e[16]||(e[16]=[n(" 处理 ")])),_:2},1032,["onClick"])):G("",!0),l(z,{type:"primary",link:"",size:"small",onClick:_e=>me(r)},{default:s(()=>e[17]||(e[17]=[n(" 详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(he,{modelValue:q.value,"onUpdate:modelValue":e[3]||(e[3]=r=>q.value=r),title:"报警详情",width:"600px"},{default:s(()=>[f.value?(x(),I(fe,{key:0,column:2,border:""},{default:s(()=>[l(D,{label:"报警时间"},{default:s(()=>[n(o(j(f.value.time)),1)]),_:1}),l(D,{label:"设备名称"},{default:s(()=>[n(o(f.value.deviceName),1)]),_:1}),l(D,{label:"报警类型"},{default:s(()=>[n(o(f.value.typeName),1)]),_:1}),l(D,{label:"报警值"},{default:s(()=>[n(o(f.value.value)+o(f.value.unit),1)]),_:1}),l(D,{label:"报警等级"},{default:s(()=>[l(a,{type:f.value.level==="error"?"danger":"warning"},{default:s(()=>[n(o(f.value.level==="error"?"严重":"警告"),1)]),_:1},8,["type"])]),_:1}),l(D,{label:"状态"},{default:s(()=>[l(a,{type:f.value.status==="active"?"danger":"success"},{default:s(()=>[n(o(f.value.status==="active"?"未处理":"已处理"),1)]),_:1},8,["type"])]),_:1})]),_:1})):G("",!0)]),_:1},8,["modelValue"])])}}});const Fe=xe(ze,[["__scopeId","data-v-fd9b9f2b"]]);export{Fe as default};
